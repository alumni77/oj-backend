<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zjedu.judge.mapper.JudgeMapper">

    <select id="getCommonJudgeList" resultType="com.zjedu.pojo.vo.JudgeVO" useCache="true">
        select j.submit_id, j.submit_time, j.display_pid, j.username, j.uid, j.pid, j.status, j.share,
        j.time, j.memory, j.score, j.oi_rank_score, j.length, j.language, j.judger, j.is_manual
        from judge j
        <where>
            <if test="username != '' and username != null">
                AND j.username like concat('%',#{username},'%')
            </if>
            <if test="status != null">
                AND j.status = #{status}
            </if>
            <if test="uid != null and uid != ''">
                AND j.uid = #{uid}
            </if>
            <if test="searchPid != null">
                <if test="completeProblemID != true">
                    AND j.display_pid like concat('%',#{searchPid},'%')
                </if>
                <if test="completeProblemID">
                    AND j.display_pid = #{searchPid}
                </if>
            </if>
        </where>
        order by j.submit_time DESC, j.submit_id DESC
    </select>

    <select id="getProblemListCount" resultType="com.zjedu.pojo.vo.ProblemCountVO">
        SELECT pid,COUNT(IF(STATUS=-3,STATUS,NULL)) AS pe,
        COUNT(IF(STATUS=-2,STATUS,NULL)) AS ce,
        COUNT(IF(STATUS=-1,STATUS,NULL)) AS wa,
        COUNT(IF(STATUS=0,STATUS,NULL)) AS ac,
        COUNT(IF(STATUS=1,STATUS,NULL)) AS tle,
        COUNT(IF(STATUS=2,STATUS,NULL)) AS mle,
        COUNT(IF(STATUS=3,STATUS,NULL)) AS re,
        COUNT(IF(STATUS=4,STATUS,NULL)) AS se,
        COUNT(IF(STATUS=8,STATUS,NULL)) AS pa,
        COUNT(*) AS total
        FROM judge
        <where>
            <if test="pidList != null and pidList.size() > 0">
                AND pid IN
                <foreach collection="pidList" item="pid" open="(" separator="," close=")">
                    #{pid}
                </foreach>
            </if>
        </where>
        GROUP BY pid
    </select>

    <select id="getProblemCount" resultType="com.zjedu.pojo.vo.ProblemCountVO">
        SELECT pid,COUNT(IF(status=-3,status,NULL)) AS pe,
        COUNT(IF(status=-2,status,NULL)) AS ce,
        COUNT(IF(status=-1,status,NULL)) AS wa,
        COUNT(IF(status=0,status,NULL)) AS ac,
        COUNT(IF(status=1,status,NULL)) AS tle,
        COUNT(IF(status=2,status,NULL)) AS mle,
        COUNT(IF(status=3,status,NULL)) AS re,
        COUNT(IF(status=4,status,NULL)) AS se,
        COUNT(IF(status=8,status,NULL)) AS pa,
        COUNT(*) AS total
        FROM judge
        <where>
            pid=#{pid}
        </where>
    </select>

    <select id="getTodayJudgeNum" resultType="int">
        SELECT count(*) FROM judge WHERE DATE(gmt_create) = CURDATE();
    </select>


</mapper>
